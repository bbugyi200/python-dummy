#!/bin/bash

#################################################################################
# Check if this project is up-to-date with the cookiecutter that generated it.
#################################################################################

SCRIPTNAME="$(basename "$0")"

function run() {
    if [[ -n "${CC_REPO_URL}" ]]; then
        if [[ -f .cruft.json ]]; then
            sed -i.bak 's#"template":.*#"template": "$(CC_REPO_URL)",#' .cruft.json
            rm -f .cruft.json.bak
        fi
    fi
    
    if cruft check --not-strict; then
        echo "Project is up-to-date."
    else
        echo "Your project is out of sync with the cookiecutter. Run 'make update-cc' to update your project."
        return 1
    fi
}

if [[ "${SCRIPTNAME}" == "$(basename "${BASH_SOURCE[0]}")" ]]; then
    run "$@"
fi
